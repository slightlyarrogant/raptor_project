eFaktura przy nadaniu statusu
Metadata

url: http://192.168.33.19/master/docs/company/procedury-standaryzacyjne/notyfikacje/notify-efaktura-przy-zmianie-statusu
scraped_at: 2024-09-05T12:17:59.496457
last_updated: 2024-09-05T12:17:59.496522
parent_id: 21c021b76586e248072c806c95187f09
path: aPaczka Plugin/Dobre praktyki/Szkolenia - B2B/Zestawienie webinaria/Zestawienie eSzkolenia/Inter stal/Handel/Magazyn/Praca z czytnikiem/Rozliczenie produkcji/Ustawienia Przyjmowanie Towaru na pakowaniu/Laguna/Analizy/Okucia/Montan stal/eFaktura przy nadaniu statusu
meta_tags: ['klienta', 'oraz', 'zakładce', 'powiadomienie', 'należy', 'powiadomienia', 'przypadku', 'poniżej', 'statusu', 'wybieramy']

Content
Cel:
Nadanie zdefiniowanego statusu dla dokumentów
Lokalizacja/wymagania
Ustawienia > Pluginy
Opis konfiguracji oraz działania funkcjonalności:
Dodanie statusu na dokumencie oraz wprowadzenie mechanizmu w pluginie
Żeby ustawić powiadomienie dotyczące wysyłania wydruku FV mailem do klienta, należy wybrać plusikiem mechanizm [Dokumenty], następnie dodajemy nazwę powiadomienia oraz wybieramy na jaką akcję ma być wysyłany mail. W tym przypadku ustawiamy akcję „Zmiana statusu”. Powiadomienie zostanie wysłane w momencie zmiany statusu przez pracownika na danej fakturze Vat. W takiej sytuacji należy dodać nowy status dla rodzaju dokumentu FV o nazwie np. „eFaktura” i zaznaczamy opcję Wymiana WWW. Statusy dla dokumentów nadajemy w [Ustawienia] > [Parametry pracy] > [Dokumenty] – [Pokaż dialog] -> wybieramy z listy [Fakturę Vat] > zakładka [Statusy] (pokazano poniżej).

Poniżej zaprezentowano jak powinna wyglądać zakładka [Główne] w opisywanym mechanizmie.

Konfiguracja w zakładce Filtry
W zakładce Filtry ustawiamy dla jakiego rodzaju dokumentu ma to zadziałać, czyli w naszym przypadku ustawiamy rodzaj FV – Faktura Vat. Jeżeli potrzebujemy, żeby zadziałało to również dla korekty Faktury Vat (KFV), musimy dodać drugi taki sam mechanizm, zmieniając tylko rodzaj dokumentu. Ważnym ustawieniem w tym mechanizmie, jest wskazanie na jaką zmianę statusu ma zadziałać powiadomienie, w tym przypadku ma być [eFaktura]. W tym miejscu można ustawić również dodatkowe warunki, jakie muszą zostać spełnione, żeby powiadomienie zostało wysłane np.

po wyżej jakiej kwoty na FV zostanie wysłane powiadomienie,
z jaką konkretną pozycją na dokumencie,
z jakiej grupy towarowej muszą być pozycje,
z jakiego magazynu

można również dodać niestandardowy warunek w postaci zapytania SQL. W naszym przypadku,standardowo wybieramy rodzaj dokumentu (pokazano na zdjęciu poniżej) oraz status.

Konfiguracja w zakładce Alerty oraz wybór typu powiadomienia
W następnej zakładce [Alerty] poprzez zielony plus, ustawiamy rodzaj powiadomienia, w tym przypadku wybieramy opcję Mail. Uzupełniamy pole Temat, następnie wybieramy z jakiego adresu mailowego ma być wysyłane powiadomienie adresy mailowe [Ustawiane] > [Słowniki] > [Konta email] oraz uzupełniamy treść powiadomienia jakie ma być widoczne w wiadomości. W treści można wykorzystać makra z programu dostępne dla dokumentów (z pliku [macros.xml] w katalogu z wersją programu). Treść maila musi zawierać tagi HTML, żeby była poprawnie wyświetlana. Ważną opcją w tej zakładce jest zaznaczenie pola [Załącznik], dzięki niemu do maila zostanie załączony plik w postaci wydruku dokumentu w formacie PDF. W wierszu poniżej możemy podać kod szablonu jaki chcemy wysłać lub zostawić to okienko puste, wtedy program wyśle szablon wydruku domyślny dla klienta. Poniżej propozycja treści powiadomienia dla eFaktury sformatowana w języku HTML (wymagany w edytorze treści):
<p><strong>Drogi Kliencie,</strong></p>

<p><br />W załączniku znajduje się Państwa faktura w postaci elektronicznej.</p>

<p><br />Wiadomość ta oraz wszelkie załączone do niej załączniki są poufne.
<br />Jeśli nie jest Pan/i zamierzonym adresatem niniejszej wiadomości, informujemy, że jej rozpowszechnianie, kopiowanie, rozprowadzanie lub inne działanie o podobnym charakterze jest zabronione i może być nielegalne. Prosimy o poinformowanie nadawcy oraz usunięcie wiadomości bez otwierania załączników.<br /> <br />

Wiadomość została wysłana automatycznie - prosimy na nią nie odpowiadać.</p>

Na poniższym zdjęciu zostało pokazane, jak powinna wyglądać wypełniona zakładka „Alerty” dla powstałej wiadomości mailowej.

Ostatnią rzeczą jaką należy uzupełnić, to zakładka [Odbiorcy] we wspomnianej wcześniej zakładce [Alerty]. W tym miejscu ustawiamy do kogo mają być wysłane powiadomienia, w przypadku powiadomienia eFaktura możemy wykorzystać dwa pola: główny mail z karty klienta wybrany na dokumencie lub wartość dowolna na karcie klienta. W obydwu przypadkach należy wykorzystać zapytania SQL.
Odnośnie pola mail z karty klienta wpisujemy:
select ph_phone from tb_telefony where ph_type = 2 and ph_datatype = 1 and ph_id = {KLIENT1.ID}

Odnośnie wartości dowolnej z karty klienta wpisujemy (należy ją dodać w [Ustawienia] > [Słowniki]:
select regexp_split_to_table(k_value132, ';') from mvv.tb_klient_mv where k_idklienta = {KLIENT1.ID}

gdzie zmienna „k_value132” to nazwa wartości dowolnej pod bazą danych i jest widoczna w słownikach dla „Wartości dowolne klienta” na definicji danej wartości dowolnej. Dzięki użyciu w zapytaniu funkcji regexp_split_to_table można wpisać w tym polu na karcie klienta, kilka adresów mailowych oddzielonych ;(średnikiem) bez odstępów.
Najczęściej eFakture ustawia się za pomocą wartości dowolnej na kartotece klienta. Dana firma musi uzupełnić sobie to pole na kartotekach swoich klientów o adresy mailowe ale dzięki temu ma pewność, że wiadomość trafi do odpowiedniej osoby zajmującej się płatnościami/fakturami. Poniżej pokazano jak należy umieść wspomniane wyżej zapytanie w zakładce [Odbiorcy].

Images




