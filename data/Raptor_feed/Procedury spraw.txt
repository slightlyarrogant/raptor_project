# Procedury spraw
Aby ułatwić i zoptymalizować prace w przypadkach, gdy czynności wykonywane są cyklicznie, system umożliwia tworzenie procedur. Dzięki temu narzędziu, użytkownik w prosty sposób może określać jak mają wyglądać poszczególne etapy konkretnego działania w firmie. W tej instrukcji został przedstawiony sposób wykorzystania procedur w Vendo, na przykładzie standardowego obiegu rejestracji dokumentów kosztowych.  
Sprawy są zbiorem zdarzeń które powstają w ustalonej kolejności jedno po drugim. Sprawę można nazwać ustalonym obiegiem przepływu informacji – dokumentów. Uruchamiając sprawę mamy z góry ustalony schemat powstawania kolejnych zdarzeń i osób które są właścicielami zdarzeń. Kolejne zdarzenie powstaje po zamknięciu zdarzenia będą jego poprzednikiem w ustalonym schemacie. Sprawa określa w ściśle określoną kolejność następujących po sobie zdarzeń.

##	Struktura sprawy

Aby rozpocząć działanie na procedurach muszą one mieć zdefioniowane podstawowe patarametry: Start, Etapy procedury oraz Stop. Sensowne jest aby istniały co najmniej dwa zdarzenia (etapy procedury) które będą początkiem i końcem sprawy. 
Sprawę tworzy się poprzez definicję poszczególnych etapów łącząc je za pomocą połączeń, łączników, switchów, pytań , zmian statusów sprawy, zmiana właściciela sprawy itp. Sprawę się tworzy poprzez ułożenie poszczególnych elementów na tzw. Schemacie blokowym procedury sprawy. 

![tmpec3e7e7f-5ba7-420b-979e-4261d51f942a](https://www.cfi.pl/vendohelp/content/imgs/S2/ab05fc3a78a552cfdd50016150b41485-23369-0.png)

Na powyższym przykładzie widoczny jest prosty schemat Sprawy dla obiegu Przygotowania Oferty dla klienta. Widoczne są elementy Start, Etapy (Kwadraty zielone z napisem poszczególnego etapu), Pytanie (niebieski romb z odpowiedziami Tak i Nie), łącznika (czarna kropka), połączenia (linie). 
Łącząc poszczególne elementy tworzymy jedną całość którą nazywamy Sprawą. Elementy te możemy podzielić na dwa rodzaje : aktywne i pasywne. Do aktywnych należą  te elementy które mogą zmienić status sprawy, tworzą nowe zdarzenia - etapy, warunki, przełączniki. Do pasywnych – połączenia, łączniki, start, stop.

###	Etapy 
Etapy są to Zdarzenia o odpowiedniej strukturze powstające na podstawie wcześniej zdefiniowanego Szablonu Zdarzenia. Etap ma za zadanie zarejestrować zdarzenie – etap w ciągu sprawy. Zdarzenie może być dowolne - kontakt, wykonanie zadanie, zarejestrowanie faktu, wykonanie wyliczenia itp. 

Etap definiuje się w `[Ustawienia]` -> `[Słowniki]` -> Grupa: `[CRM]` -> `[Etapy Procedury Spraw]`
W tym miejscu możemy dodać nowy etap lub edytować już istniejący, ewentualnie usunąć już istniejący. Etap powstaje na podstawie już istniejącego Szablonu zdarzenia. Etap składa się z:
-	Szablon zdarzenia – zdefiniowany wcześniej szablon
-	Nazwa  - dowolna nazwa Etapu zdefiniowana przez użytkownika i widocznego na powstałym zdarzeniu
-	Wywołaj skrypt – wykonywany skrypt w momencie powstania zdarzenia

![tmpe01b65ad-1391-4667-9892-0d42dc5b7469](https://www.cfi.pl/vendohelp/content/imgs/X3/709c249d18f545fbc8e6459db07f8bfc-8249-0.png)


Szablon zdarzenia jest to sformatowane zdarzenie powstałego etapu sprawy – procedury. Definiuje się go w `[Ustawienia]` -> `[Słowniki]` -> Grupa `[CRM]`  -> `Szablony Zdarzeń`. Tutaj można tworzyć, edytować lub usuwać Szablony Zdarzeń.  Szablon zdarzeń ma na celu wypełnienie zdarzenia odpowiednimi danymi zgodnie z ustalonymi danymi. 

![tmpf84172d2-4320-42c9-985c-17a6b950d647](https://www.cfi.pl/vendohelp/content/imgs/Z3/2d279b78fee4b3b3877ac11c67138418-32299-0.png)

Taki szablon dzielimy na kilka elementów które należy zdefiniować :
-	Ogólne 
    - Nazwa – definiujemy dowolną nazwę szablonu 
    - Rodzaj zdarzenia  - zdefiniowane wcześniej rodzaje zdarzeń
    -Typ
    - Źródło marka – poziom danych dostępny dla makr
    - Temat – definicja tematu zdarzenia
    - Opis 
    - Zlecenie ID
    - Ustaw dokument jako załącznik 
-	Sprawa – Utwórz sprawę – zdarzenie startujące dla sprawy – tworząc zdarzenie wg tego szablonu tworzymy od razu sprawę
-	Klient
    - Klient – skąd pobierany będzie klient dla zdarzenia  (dokument, wybierany z listy, z poprzednika, zlecenie.
    - Osoba – skąd ma być pobrany osoba do zdarzenia – Domyślna, Z dokumentu, z poprzednika
-	Właściciel Zdarzenia
        - Właściciel zdarzenia – osoba do której będzie przypisane zdarzenie, może to być dział, pracownik, dział pracownika
    - Pracownik – skąd będzie pobrany pracownik do zdarzenia – właściciel zdarzenia, poprzednika, zalogowany, z dokumentu
    - Pytaj o wybór jeśli wskazanie nie jest jednoznaczne 
    - Wybierz pracownika z ostatniego etapu
- Daty zdarzenia – jak mają się ustawić daty zdarzenia
        - Typ planowania – automatyczne, ręcznie
        - Typ ograniczenia 
        - Czas trwania
        - Termin
        - Opóźnienie
-	Triggerry – Zmiana statusu zlecenia przy zamykaniu zdarzenia

Można dodatkowo zdefiniować dla których pracowników dostępny będzie ten szablon zdarzenia (zakładka Pracownicy) oraz dla których klientów można zastosować ten szablon (zakładka Klienci)

### Pytanie

Pytanie jest warunkiem logicznym na które odpowiadamy TAK lub NIE. W zależności od sprawa pójdzie osobną ścieżką. Należy pamietać, iż tworząc pytanie musimy ustawić treść pytania. Pytanie to pojawi się podczas przechodzenia do następnego etapu sprawy. W zależności od wyboru odpowiedzi przejdziemy do następnego etapu z odpowiednia treścią zdarzenia

![tmpb324126c-6ad1-4b87-b7a9-e451ee266d2c](https://www.cfi.pl/vendohelp/content/imgs/K0/dac59b9b90b9f4dcbb8f9f4b4a56d014-9055-0.png)

### Switch
działanie switch'a jest podobne do Pytania, jednak do wyboru są kolejne ścieżki/ etapy procedury. Nie odpowiada się na pytania jednak wybiera dostępny z lity etap procedury. Podczas przechodzenia poprzez kolenie etapy procedury, przy switchu  pojawi się lista do wyboru etapów.

![tmpf631504f-4028-4850-8c0a-f35d8c92e80d](https://www.cfi.pl/vendohelp/content/imgs/Q6/1d1ecc519865eefc2b2f1272a0b9e008-7679-0.png)

## 	Utworzenie nowej procedury w systemie
Wprowadzenie nowej procedury w programie zaczynamy od przejścia do `[Ustawienia]` > `[Słowniki]` > `[Procedury spraw]` w sekcji `[CRM]`. W tym miejscu tworzone są wszystkie procedury, które będą wykorzystywane w firmie.
![tmp1dfa633c-87a2-46fc-8cc1-c94702b3b122](https://www.cfi.pl/vendohelp/content/imgs/I0/9837aaa8edd0aeaba0ca9dab92abefd4-16058-0.png)


W otwartym okienku klikamy przycisk Dodaj lub klawisz `[Insert]` z klawiatury i dodajemy nową kartę procedury. Przy dodaniu należy uzupełnić pola `[Kod procedury]`, `[Nazwę procedury]` oraz wybrać `[Rodzaj sprawy]`, tak jak pokazano na poniższym zrzucie ekranu. 

![tmp5b7c0757-437b-493e-8a7e-f34ef0c01a72](https://www.cfi.pl/vendohelp/content/imgs/E6/4fdf9fdcdade242934a7ecc236a68341-198926-0.png)

Po otwarciu okna nowej procedury przechodzimy do ułożenia całego schematu postępowania, jak dana rejestracja dokumentu kosztowego ma przebiegać. Do tego używamy przycisku `[Schemat]`, który staje się aktywny po pierwszym zapisaniu nowej karty procedury. Po kliknięciu otrzymamy nowe okienko

W prezentowanym oknie tworzymy graficzny schemat, w jaki sposób dana procedura ma przebiegać. W górnej belce dostępnego menu zaczynając od lewej strony mamy następujące opcje do wyboru:
-	zapis dotychczasowych zmian w procedurze,
-	wydruk graficzny na drukarce,
-	cofnij,
-	powtórz,
-	usuń.
Dodatkowo są dostępne poszczególne elementy, jakie wykorzystujemy w procedurze. W naszej procedurze będziemy wykorzystywać następujące elementy:

![tmp09b81900-efe2-4849-8a20-423e9f22194d](https://www.cfi.pl/vendohelp/content/imgs/Z9/3b067285335d103e22a4e298bd895f03-17653-0.png) Start – rozpoczęcie danej procedury,

![tmp3f6ac970-299b-477b-b20f-f74fd0bb0717](https://www.cfi.pl/vendohelp/content/imgs/P7/7c4d08107d887f3ee016bb7f74785200-18457-0.png) Stop – zakończenie danej procedury

![tmp9f03f9a1-fed3-4e5f-8af5-f8b56713a20d](https://www.cfi.pl/vendohelp/content/imgs/K0/b5cd4516979b6ea4b7324cf49fa9f019-1567-0.png) Etap – blok związany ze zdarzeniem utworzonym podczas przejścia do następnego kroku procedury, 

![tmp71a9503d-c1c2-4e49-911d-95148d171629](https://www.cfi.pl/vendohelp/content/imgs/K6/05f541660621f038ad851e0959efc86d-3415-0.png) Element specjalny w postaci dodania Załącznika do zdarzenia

![tmp1713d455-404f-41c5-b217-1d750be8b9e2](https://www.cfi.pl/vendohelp/content/imgs/E2/85481b6d2848d7414e0bbbdd400a221f-7313-0.png) Pytanie – możliwość pójścia w dwie różne strony w zależności od postawionego pytania

Łącznik – pozwala łączyć różne drogi prowadzonej procedury,
Połączenie – łączy ze sobą poszczególne elementy wskazując kierunek procedury.


## Nowa procedura w oparcji o dokument kosztowy

Rozpoczynając tworzenie procedury zawsze zaczynamy od bloku [Start], który znajdzie się u samej góry procedury. Następnie tworzymy pierwszy etap, który będzie nazywał się Rejestracja dokumentu kosztowego. Aby dodać nowy etap, wybieramy klocek etapu a następnie poprzez przycisk [Funkcje] > [Dodaj] (1), dodajemy nowy etap. Z nowo otwartego okna klikamy w ikonkę 3-ech kropek […] (2) w wierszu Szablon zdarzenia, otworzy się nowe okno z dostępnymi szablonami, gdzie możemy dodać nowe szablony zdarzeń (3).

![tmp194504c3-ba14-4076-a3f4-1cf156a76f76](https://www.cfi.pl/vendohelp/content/imgs/C4/398d1bfb20a854036cbacb0f172f83d7-61788-0.png)

W nowo otwartym oknie konfigurujemy szczegóły dotyczące szablonu zdarzenia, które będzie jednym z naszych etapów sprawy w tworzonej procedurze. 

![tmp375bfb08-cfb4-40aa-b699-bb3f22bafa24](https://www.cfi.pl/vendohelp/content/imgs/A0/7749b6dd75b5d4613b6d7c52f3d176b1-119339-0.png)

W tymi miejscu należy wypełnić pola opisane poniżej, w sekcji ogólne:
-	Nazwa – uzupełniamy nazwę szablonu zdarzenia,
-	Rodzaj – wybieramy rodzaj zdarzenia jakie będzie tworzone z dostępnych rodzajów zdarzeń w programie,
-	Źródło makra – czyli skąd mają być pobierane makra do pól tekstowych, zazwyczaj ustawiamy Nowe zdarzenie,
-	Temat – możemy wykorzystać makra z programu dostępne w katalogu z wersją programu w pliku o nazwie macors.xml, w tym miejscu można wpisać makro `{Etap.Nazwa}`, które wywoła wpisanie do tematu zdarzenia nazwę z szablonu,
-	Opis – pole, gdzie chcemy wprowadzić dodatkowe informacje dla pracownika zdarzenia, można użyć również makra jak w poprzednim przypadku.
W sekcji Klient:
-	Klient - wybieramy skąd ma być ustawiony klient, w tym miejscu możemy wybrać opcję Wybrany co spowoduje wybór klienta przez pracownika na zdarzeniu,
-	Osoba – możemy wskazać czy ma się podpinać osoba z pod klienta (jeżeli istnieje). W sekcji Właściciel zdarzenia:
-	Właściciel zdarzenia – wskazujemy czy ma to być Dział, Dział pracownika czy Pracownik,
-	Pracownik - zazwyczaj w pierwszym etapie wybieramy aby była to osoba zalogowana czyli osoba tworząca procedurę ale w następnych etapach wskazujemy konkretny dział pracowników lub konkretnego pracownika (w opcji po prawej stronie),
-	Rola – możemy ograniczyć wybór pracownika do danej roli pracownika,
-	Pytaj o wybór jeśli wskazanie nie jest jednoznaczne – gdy zaznaczymy tą opcję i program nie będzie wiedział jakiego pracownika wskazać, wyświetli okno z listą pracowników do wyboru podczas przejścia do następnego etapu w procedurze,
-	Wybierz pracownika z ostatniego etapu (jeżeli istnieje) – gdy zaznaczone program ustawi takiego samego pracownika jak w poprzednim etapie. W sekcji Daty zdarzenia:
-	Typ planowania – mamy do wyboru dwie możliwości:
-	Automatyczne – w przypadku automatycznego planowania program sam ustawi datę rozpoczęcia i zakończenia danego etapu, wskaże możliwość wyboru w jaki sposób czas ma być ograniczony (Aktualny czas, Jak najwcześniej – planowanie od początku procedury, Jak najpóźniej – planowanie od końca procedury), będzie możliwość ustawienia Czasu trwania danego etapu oraz pozwoli ustawić termin i maksymalne opóźnienie etapu. Najczęściej wskazujemy właśnie to planowanie,
-	Ręczne – w przypadku ręcznego planowania to my musimy ustawić rozpoczęcie, zakończenie termin oraz odpowiednio do każdego ustawiamy opóźnienie.
W sekcji Triggery:
-	Zmiana statusu zlecenia przy zamykaniu zdarzenia – poprzez to ustawienie mamy możliwość wymusić by program zmienił status na skojarzonym zleceniu (jeżeli jest podpięte). Wybieramy status z utworzonych pod danym zleceniem w ustawieniach programu ([Ustawienia] > [Słowniki] > [Statusy dla zleceń]). W naszym przypadku powyższe ustawienia możemy wybrać, tak jak wskazano na wcześniej umieszczonym zrzucie ekranu. 



W następnym kroku będziemy ustawiali zmianę statusu załącznika, czyli podpiętego dokumentu kosztowego wprowadzonego w Vendo jako dokument KO. W tym przypadku korzystamy z elementu specjalnego i wybieramy opcję Załącznik. W nowo otwartym okienku jako Rodzaj załącznika wybieramy [główny i zwykły], Typ załącznika - [obiekt], Obiekt wybieramy z listy dokument kosztowy, wskazujmy Status jaki ma być ustawiony czyli np. [Dokument Zarejestrowany]. Aby utworzyć potrzebne statusy dla dokumentu KO (w zależności jak wcześniej skonfigurowaliśmy ten parametr, czyli jaki wybieraliśmy dokument), wchodzimy w [Ustawienia] -> [Parametry pracy] -> [Dokumenty] – [pokaż dialog] -> wybieramy z listy odpowiedni dokument -> zakładka [Status]. W tym miejscu tworzymy nowe statusy. Opisane ustawienia powinny prezentować się jak poniżej, pozostałe zmiany statusów jakie pojawią się w tworzonej procedurze ustawiamy identycznie zmieniając tylko status.

![tmpebeee639-5a2f-42c5-bc12-6ed0b3402e52](https://www.cfi.pl/vendohelp/content/imgs/B3/3ebd028f33538aeb4b596488e60358e2-75378-0.png)

Następnym krokiem w procedurze jest dodanie nowego etapu, tak jak poprzednio opisano wybierając odpowiednie ustawienia.

W dalszej części procedury będzie postawione pytanie, od którego zależeć będzie czy procedura ma przejść do etapu 'Odesłanie dokumentu do dostawcy, prośba o korektę' a następnie zakończy ona procedurę (na końcu blok [STOP]) lub czy trafi do etapu Akceptacji przez kierownika i będzie dalej procedowana. Pytanie będzie następujące: Czy usługa została wykonana?. Jeżeli odpowiedź będzie twierdząca, to w następnym kroku ustawiamy nową zmianę statusu podpiętego dokumentu na Akceptacja merytoryczna.

Opisane powyżej etapy sa przykładem jak mogą wygladac pierwsze kroki związane z jej tworzeniem. Etapy nalezy tworzyc zgodnie z polityką firmy stosując powyższe zalecenia dotyczace jej tworzenia. 

Utworzoną procedurę trzeba jeszcze oczywiście zapisać. Należy pamiętać żeby wszystkie połączenia zostały poprawnie podpięte pod dane elementy (etapy, pytania itp.) oraz by nie wystąpiła sytuacja, że w którymś miejscu procedura nie zostanie połączona. Gdyby nastąpiła taka sytuacja, to przy zapisie procedury, program pokaże komunikat z treścią Istnieją elementy nieosiągalne.

## Zasada działania - Uruchomienie procedury
W celu uruchomienia nowo powstałej procedury przechodzimy do modułu [CRM] i wybieramy miejsce z którego chcemy wywołać procedurę. Tym miejscem są zakładki, gdzie można dodać nowe zdarzenie np. Zdarzenia lub kalendarz. Aby dodać nową procedurę zazwyczaj wybieramy funkcję [Dodaj zgodnie z procedurą] a następnie z nowo otwartego okna wskazujemy naszą procedurę.  
![tmpc06dfa00-d53c-4439-a07d-044632969e30](https://www.cfi.pl/vendohelp/content/imgs/J9/31c92e5855254f91d57cc6436a7f2a27-65139-0.png)

 Po uruchomieniu procedury automatycznie wypełnione zostaną pola [Temat sprawy] oraz [Temat]. Od tego momentu system będzie działał ściśle według zdefiniowanego wcześniej schematu - procedury. Zdarzenia wynikające z Procedury mogą być delegowane pomiędzy pracownikami bądź działami a przekazanie ich odbywa się poprzez kliknięcie niebieskiej strzałki w lewym górnym rogu okna zdarzenia.

![tmp1cbec057-08e5-4ef4-864d-219edb670c63](https://www.cfi.pl/vendohelp/content/imgs/L5/14f4858aad7bfce788a7c01e2aaac19b-118137-0.png)